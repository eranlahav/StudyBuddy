---
phase: 03-recommendation-engine
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - hooks/useRecommendations.ts
  - hooks/index.ts
autonomous: true

must_haves:
  truths:
    - "Hook combines profile, tests, and goals data to generate recommendations"
    - "Recommendations update when profile, tests, or goals change"
    - "Override handler removes topic from recommendations and logs to Firestore"
  artifacts:
    - path: "hooks/useRecommendations.ts"
      provides: "Recommendation orchestration hook"
      exports: ["useRecommendations"]
  key_links:
    - from: "hooks/useRecommendations.ts"
      to: "services/recommendationService.ts"
      via: "import"
      pattern: "scoreTopic|generateRecommendations|recordOverride"
    - from: "hooks/useRecommendations.ts"
      to: "hooks/useLearnerProfile.ts"
      via: "import"
      pattern: "useLearnerProfile"
---

<objective>
Create useRecommendations hook to orchestrate recommendation generation

Purpose: Provide a React hook that combines learner profile, upcoming tests, and learning goals to generate prioritized topic recommendations with override capability.

Output: useRecommendations.ts hook that returns recommendations array and handleOverride function
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-recommendation-engine/03-RESEARCH.md
@.planning/phases/03-recommendation-engine/03-01-SUMMARY.md

# Dependencies
@types.ts
@hooks/useLearnerProfile.ts
@hooks/index.ts
@services/recommendationService.ts
@store.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useRecommendations hook</name>
  <files>hooks/useRecommendations.ts</files>
  <action>
Create `hooks/useRecommendations.ts` following existing hook patterns (see useLearnerProfile.ts):

```typescript
/**
 * useRecommendations Hook
 *
 * Generates prioritized topic recommendations by combining:
 * - Learner profile mastery data (30% weight)
 * - Upcoming test urgency (40% weight)
 * - Parent learning goals (30% weight)
 *
 * Returns 3-5 balanced recommendations with override capability.
 *
 * Usage:
 *   const { recommendations, handleOverride, isLoading } = useRecommendations(child, subject, goals);
 */
```

Implement interface:

```typescript
export interface UseRecommendationsReturn {
  recommendations: Recommendation[];
  isLoading: boolean;
  error: Error | null;
  handleOverride: (topic: string, reason: OverrideReason, customReason?: string) => Promise<void>;
  refresh: () => void;
}
```

Implement `useRecommendations(child, subject, goals)`:

1. **State:**
   - recommendations: Recommendation[]
   - overrides: Set<string> (locally dismissed topics)
   - error: Error | null

2. **Dependencies:**
   - Use `useLearnerProfile(child, [])` to get profile
   - Use `useStore()` to access upcomingTests and parent
   - goals parameter passed from parent component

3. **useEffect for calculation** (deps: child, subject, profile, upcomingTests, goals, overrides):
   - Guard: if !child || !subject, set empty recommendations, return
   - Filter upcomingTests for this child + subject
   - Score all subject.topics using scoreTopic()
   - Generate recommendations using generateRecommendations(scoredTopics, 5)
   - Filter out topics in overrides Set
   - setRecommendations(filtered)
   - Log with logger.debug/info

4. **handleOverride callback:**
   - Add topic to overrides Set immediately (optimistic UI)
   - Call recordOverride() fire-and-forget
   - Catch errors and log (don't throw)

5. **refresh function:**
   - Clear overrides Set to regenerate fresh recommendations

Return: { recommendations, isLoading: profileLoading, error, handleOverride, refresh }

Important patterns:
- Use useCallback for handleOverride
- Wrap calculation in try-catch with setError
- Log meaningful debug info for troubleshooting
  </action>
  <verify>Run `npx tsc --noEmit` - no type errors</verify>
  <done>useRecommendations hook generates balanced recommendations and handles overrides</done>
</task>

<task type="auto">
  <name>Task 2: Export useRecommendations from hooks/index.ts</name>
  <files>hooks/index.ts</files>
  <action>
Add to hooks/index.ts after the Learner profile exports:

```typescript
// Recommendations
export { useRecommendations } from './useRecommendations';
export type { UseRecommendationsReturn } from './useRecommendations';
```
  </action>
  <verify>Import test: `import { useRecommendations } from './hooks'` compiles</verify>
  <done>useRecommendations exported from hooks index</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. hooks/useRecommendations.ts exports useRecommendations and UseRecommendationsReturn
3. hooks/index.ts re-exports the hook
4. Hook correctly imports from useLearnerProfile, store, and recommendationService
</verification>

<success_criteria>
- Hook combines profile, tests, and goals to generate recommendations
- Recommendations update reactively when dependencies change
- handleOverride removes topic from view and logs to Firestore
- refresh clears overrides for fresh recommendations
- Loading state reflects profile loading
</success_criteria>

<output>
After completion, create `.planning/phases/03-recommendation-engine/03-03-SUMMARY.md`
</output>
