---
phase: 05-profile-maintenance-visualization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - types.ts
  - lib/forgettingCurve.ts
  - lib/index.ts
autonomous: true

must_haves:
  truths:
    - "Mastered topic (pKnown=0.85) decays to ~66% after 8 weeks without practice"
    - "Learning topics decay faster than mastered topics"
    - "Weak topics decay fastest (already struggling)"
    - "No topic drops below 5% floor (residual knowledge)"
  artifacts:
    - path: "lib/forgettingCurve.ts"
      provides: "Time-based decay calculation functions"
      exports: ["applyForgettingCurve", "applyForgettingCurveToProfile", "FORGETTING_CONFIG"]
    - path: "types.ts"
      provides: "Extended TopicMastery with probe scheduling fields"
      contains: "nextProbeDate"
  key_links:
    - from: "lib/forgettingCurve.ts"
      to: "lib/signalWeights.ts"
      via: "daysSince import"
      pattern: "import.*daysSince.*from.*signalWeights"
---

<objective>
Create the forgetting curve library and extend types for probe scheduling.

Purpose: Enable time-based mastery decay so profiles stay accurate when topics go unpracticed. This is the foundation for the SM-2 probe scheduler in Plan 03.

Output: `lib/forgettingCurve.ts` with decay functions, extended `TopicMastery` type with `nextProbeDate` and `probeIntervalDays` fields.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-profile-maintenance-visualization/05-RESEARCH.md

# Existing files to reference
@lib/signalWeights.ts
@types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend TopicMastery type with probe fields</name>
  <files>types.ts</files>
  <action>
Add two optional fields to the TopicMastery interface:

```typescript
// Add to TopicMastery interface (after parentNotes field):
  /** Next scheduled probe date (timestamp) */
  nextProbeDate?: number;
  /** Current probe interval in days (doubles on success) */
  probeIntervalDays?: number;
```

These fields are optional for backward compatibility with existing profiles.
  </action>
  <verify>Run `npx tsc --noEmit` - no type errors</verify>
  <done>TopicMastery has nextProbeDate and probeIntervalDays optional fields</done>
</task>

<task type="auto">
  <name>Task 2: Create forgetting curve library</name>
  <files>lib/forgettingCurve.ts, lib/index.ts</files>
  <action>
Create `lib/forgettingCurve.ts` with:

1. **FORGETTING_CONFIG** constant:
   - DECAY_RATES: { mastered: 0.95, learning: 0.92, weak: 0.88 } (weekly multipliers)
   - MIN_PKNOWN: 0.05 (floor)
   - ENABLED: true (global toggle)

2. **applyForgettingCurve(mastery: TopicMastery): TopicMastery**
   - Calculate weeks since lastAttempt using daysSince from signalWeights.ts
   - Select decay rate based on current pKnown level:
     - mastered (>=0.8): 0.95/week
     - learning (0.5-0.8): 0.92/week
     - weak (<0.5): 0.88/week
   - Apply: newPKnown = originalPKnown * (decayRate ^ weeks)
   - Floor at MIN_PKNOWN (0.05)
   - Return copy with decayed pKnown (don't modify lastAttempt - decay is read-only)
   - If ENABLED is false, return unchanged mastery

3. **applyForgettingCurveToProfile(profile: LearnerProfile): LearnerProfile**
   - Apply decay to all topics in topicMastery
   - Return new profile object (immutable)

4. **Export from lib/index.ts**

**Math verification:**
- Mastered (0.85) after 8 weeks: 0.85 * 0.95^8 = 0.85 * 0.663 = 0.56 (approximately 66% of original = 56%)
- The success criteria says "decay to 66% confidence" which means 66% of original pKnown

Use `daysSince` from `lib/signalWeights.ts` (already exists) for recency calculation.
  </action>
  <verify>
Create a simple test in the file comments showing:
- Mastered topic (0.85) after 56 days (8 weeks): ~0.56 (66% of 0.85)
- Learning topic (0.65) after 56 days: ~0.34
- Weak topic (0.35) after 56 days: ~0.13

Run `npx tsc --noEmit` - no type errors
  </verify>
  <done>
applyForgettingCurve correctly decays pKnown based on time since lastAttempt.
Mastered topic reaches ~66% of original value after 8 weeks (success criteria #1).
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors: `npx tsc --noEmit`
2. Forgetting curve math verified:
   - 0.85 * 0.95^8 = ~0.56 (66% retention)
   - 0.65 * 0.92^8 = ~0.34 (52% retention)
   - 0.35 * 0.88^8 = ~0.13 (37% retention)
3. TopicMastery type has new optional fields
4. lib/index.ts exports forgetting curve functions
</verification>

<success_criteria>
- Mastered topics decay to 66% after 8 weeks (meets success criteria #1)
- Learning topics decay faster (0.92/week vs 0.95/week)
- Weak topics decay fastest (0.88/week)
- Floor at 5% prevents complete knowledge loss
- Types extended for probe scheduling (Plan 03 foundation)
</success_criteria>

<output>
After completion, create `.planning/phases/05-profile-maintenance-visualization/05-01-SUMMARY.md`
</output>
