---
phase: 05-profile-maintenance-visualization
plan: 05
type: execute
wave: 3
depends_on: ["05-01"]
files_modified:
  - pages/ChildDetails/SkillRadarChart.tsx
  - pages/ChildDetails/ProgressTimeline.tsx
autonomous: true

must_haves:
  truths:
    - "Radar chart shows pKnown for all skills in a subject"
    - "Timeline chart shows mastery progress over time"
    - "Both charts are RTL-compatible (Hebrew)"
    - "Empty states handled gracefully (min 3 topics for radar)"
  artifacts:
    - path: "pages/ChildDetails/SkillRadarChart.tsx"
      provides: "Radar chart visualization component"
      min_lines: 80
    - path: "pages/ChildDetails/ProgressTimeline.tsx"
      provides: "Area chart timeline component"
      min_lines: 80
  key_links:
    - from: "pages/ChildDetails/SkillRadarChart.tsx"
      to: "recharts"
      via: "RadarChart import"
      pattern: "import.*RadarChart.*from.*recharts"
    - from: "pages/ChildDetails/ProgressTimeline.tsx"
      to: "recharts"
      via: "AreaChart import"
      pattern: "import.*AreaChart.*from.*recharts"
---

<objective>
Create visualization components for skill distribution and progress timeline.

Purpose: Transform profile data into actionable visual insights. Parents can see strengths/weaknesses at a glance (radar) and track improvement over time (timeline).

Output: `SkillRadarChart.tsx` with radar visualization, `ProgressTimeline.tsx` with area chart timeline.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-profile-maintenance-visualization/05-RESEARCH.md

# Existing recharts usage
@pages/ChildDetails/AnalysisTab.tsx

# Types
@types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SkillRadarChart component</name>
  <files>pages/ChildDetails/SkillRadarChart.tsx</files>
  <action>
Create `pages/ChildDetails/SkillRadarChart.tsx`:

```typescript
/**
 * SkillRadarChart - Radar visualization of topic mastery
 *
 * Shows pKnown distribution across all topics in a subject.
 * Uses recharts RadarChart for polar visualization.
 * Requires minimum 3 topics for meaningful display.
 */

import React from 'react';
import {
  RadarChart,
  PolarGrid,
  PolarAngleAxis,
  PolarRadiusAxis,
  Radar,
  ResponsiveContainer,
  Legend,
  Tooltip
} from 'recharts';
import { LearnerProfile } from '../../types';

interface SkillRadarChartProps {
  profile: LearnerProfile;
  subjectId: string;
  subjectName: string;
}

export const SkillRadarChart: React.FC<SkillRadarChartProps> = ({
  profile,
  subjectId,
  subjectName
}) => {
  // Extract topics for this subject
  const topics = Object.values(profile.topicMastery)
    .filter(m => m.subjectId === subjectId)
    .sort((a, b) => b.pKnown - a.pKnown) // Highest first
    .slice(0, 8); // Max 8 topics for readability

  // Need at least 3 topics for radar chart
  if (topics.length < 3) {
    return (
      <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
        <h3 className="text-lg font-bold text-gray-900 mb-4">
          מפת מיומנויות - {subjectName}
        </h3>
        <div className="text-center py-8 text-gray-500">
          <p>לא מספיק נושאים להצגת גרף מכ״ם</p>
          <p className="text-sm mt-1">נדרשים לפחות 3 נושאים</p>
        </div>
      </div>
    );
  }

  // Transform to recharts format
  const data = topics.map(t => ({
    topic: t.topic.length > 12 ? t.topic.slice(0, 12) + '...' : t.topic,
    mastery: Math.round(t.pKnown * 100),
    fullTopic: t.topic
  }));

  return (
    <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
      <h3 className="text-lg font-bold text-gray-900 mb-4">
        מפת מיומנויות - {subjectName}
      </h3>

      <ResponsiveContainer width="100%" height={350}>
        <RadarChart data={data} cx="50%" cy="50%" outerRadius="80%">
          <PolarGrid stroke="#e5e7eb" />
          <PolarAngleAxis
            dataKey="topic"
            tick={{ fill: '#6b7280', fontSize: 11 }}
            tickLine={false}
          />
          <PolarRadiusAxis
            angle={90}
            domain={[0, 100]}
            tick={{ fill: '#9ca3af', fontSize: 10 }}
            tickCount={5}
          />
          <Radar
            name="שליטה"
            dataKey="mastery"
            stroke="#6366f1"
            fill="#6366f1"
            fillOpacity={0.5}
            strokeWidth={2}
          />
          <Tooltip
            contentStyle={{
              borderRadius: '8px',
              border: 'none',
              boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)',
              direction: 'rtl',
              textAlign: 'right'
            }}
            formatter={(value: number) => [`${value}%`, 'שליטה']}
          />
          <Legend
            wrapperStyle={{ direction: 'rtl', paddingTop: '16px' }}
            iconType="circle"
          />
        </RadarChart>
      </ResponsiveContainer>

      <p className="text-xs text-gray-500 text-center mt-2">
        כל ציר מייצג נושא, המרחק מהמרכז = רמת שליטה (0-100%)
      </p>
    </div>
  );
};

export default SkillRadarChart;
```

Key features:
- Maximum 8 topics for readability
- Topic labels truncated to 12 chars
- RTL tooltip and legend
- Hebrew labels and explanatory text
- Empty state for < 3 topics
  </action>
  <verify>Run `npx tsc --noEmit` - no type errors</verify>
  <done>
Radar chart displays pKnown across skills (success criteria #5).
RTL-compatible with Hebrew labels.
Empty state for insufficient data.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ProgressTimeline component</name>
  <files>pages/ChildDetails/ProgressTimeline.tsx</files>
  <action>
Create `pages/ChildDetails/ProgressTimeline.tsx`:

```typescript
/**
 * ProgressTimeline - Area chart showing mastery progress over time
 *
 * Displays estimated pKnown trajectory for a specific topic.
 * Note: Historical pKnown not stored in Phase 1-4, so this uses
 * session accuracy as a proxy for historical mastery.
 */

import React, { useMemo } from 'react';
import {
  AreaChart,
  Area,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer
} from 'recharts';
import { StudySession, TopicMastery } from '../../types';

interface ProgressTimelineProps {
  topic: string;
  sessions: StudySession[];
  currentMastery?: TopicMastery;
}

export const ProgressTimeline: React.FC<ProgressTimelineProps> = ({
  topic,
  sessions,
  currentMastery
}) => {
  const timelineData = useMemo(() => {
    // Filter sessions for this topic
    const topicSessions = sessions
      .filter(s => s.topic === topic)
      .sort((a, b) => a.date - b.date); // Chronological

    if (topicSessions.length === 0) return [];

    // Build timeline points using session accuracy
    // Note: This is approximate - true pKnown history would require schema change
    const points = topicSessions.map((session, index) => {
      const accuracy = session.totalQuestions > 0
        ? (session.score / session.totalQuestions) * 100
        : 0;

      return {
        date: new Date(session.date).toLocaleDateString('he-IL', {
          day: '2-digit',
          month: '2-digit'
        }),
        accuracy: Math.round(accuracy),
        // Estimate mastery: weighted blend of accuracy and position in sequence
        mastery: Math.round(
          Math.min(100, accuracy * (0.5 + (index / topicSessions.length) * 0.5))
        ),
        questions: session.totalQuestions
      };
    });

    // Add current mastery point if available
    if (currentMastery) {
      points.push({
        date: 'עכשיו',
        accuracy: Math.round(
          (currentMastery.correctCount / Math.max(1, currentMastery.correctCount + currentMastery.incorrectCount)) * 100
        ),
        mastery: Math.round(currentMastery.pKnown * 100),
        questions: currentMastery.attempts
      });
    }

    return points;
  }, [sessions, topic, currentMastery]);

  if (timelineData.length === 0) {
    return (
      <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
        <h3 className="text-lg font-bold text-gray-900 mb-4">
          מגמת התקדמות - {topic}
        </h3>
        <div className="text-center py-8 text-gray-500">
          <p>אין מספיק נתונים היסטוריים</p>
          <p className="text-sm mt-1">נתונים יופיעו אחרי תרגולים נוספים</p>
        </div>
      </div>
    );
  }

  return (
    <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
      <h3 className="text-lg font-bold text-gray-900 mb-4">
        מגמת התקדמות - {topic}
      </h3>

      <ResponsiveContainer width="100%" height={280}>
        <AreaChart data={timelineData}>
          <defs>
            <linearGradient id="masteryGradient" x1="0" y1="0" x2="0" y2="1">
              <stop offset="5%" stopColor="#6366f1" stopOpacity={0.8}/>
              <stop offset="95%" stopColor="#6366f1" stopOpacity={0.1}/>
            </linearGradient>
          </defs>
          <CartesianGrid strokeDasharray="3 3" vertical={false} />
          <XAxis
            dataKey="date"
            tick={{ fill: '#6b7280', fontSize: 11 }}
            tickLine={false}
            axisLine={false}
          />
          <YAxis
            domain={[0, 100]}
            tick={{ fill: '#6b7280', fontSize: 11 }}
            tickLine={false}
            axisLine={false}
            unit="%"
            orientation="right"
          />
          <Tooltip
            contentStyle={{
              borderRadius: '8px',
              border: 'none',
              boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)',
              direction: 'rtl',
              textAlign: 'right'
            }}
            formatter={(value: number, name: string) => {
              const label = name === 'mastery' ? 'שליטה' : 'דיוק';
              return [`${value}%`, label];
            }}
          />
          <Area
            type="monotone"
            dataKey="mastery"
            stroke="#6366f1"
            strokeWidth={2}
            fill="url(#masteryGradient)"
            name="mastery"
          />
        </AreaChart>
      </ResponsiveContainer>

      <div className="mt-4 flex items-center justify-center gap-6 text-sm">
        <div className="flex items-center gap-2">
          <div className="w-3 h-3 bg-indigo-500 rounded-full"></div>
          <span className="text-gray-600">רמת שליטה משוערת</span>
        </div>
        <div className="text-gray-500">
          {timelineData.length} נקודות מדידה
        </div>
      </div>

      <p className="text-xs text-gray-400 text-center mt-2">
        * נתונים היסטוריים משוערים על בסיס דיוק בתרגולים
      </p>
    </div>
  );
};

export default ProgressTimeline;
```

Key features:
- Chronological session display
- Estimated mastery from accuracy (Phase 1-4 limitation)
- Gradient fill for visual appeal
- RTL tooltip and labels
- Disclaimer about approximation
- Empty state for no data
  </action>
  <verify>Run `npx tsc --noEmit` - no type errors</verify>
  <done>
Timeline shows mastery progress over time (success criteria #6).
RTL-compatible with Hebrew labels.
Approximation disclaimer acknowledges limitation.
Empty state for insufficient data.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors: `npx tsc --noEmit`
2. SkillRadarChart:
   - Renders with 3+ topics
   - Shows empty state with < 3 topics
   - Topic labels truncated appropriately
   - RTL legend and tooltip
3. ProgressTimeline:
   - Renders session history chronologically
   - Includes current mastery point
   - Shows empty state with no sessions
   - Approximation disclaimer present
4. Both components use consistent styling with existing AnalysisTab
</verification>

<success_criteria>
- Radar chart shows pKnown distribution (success criteria #5)
- Timeline shows progress over time (success criteria #6)
- RTL-compatible with Hebrew labels
- Empty states handled gracefully
</success_criteria>

<output>
After completion, create `.planning/phases/05-profile-maintenance-visualization/05-05-SUMMARY.md`
</output>
